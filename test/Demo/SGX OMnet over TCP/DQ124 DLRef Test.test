<?xml version="1.1" encoding="ASCII"?>
<TestUnit:TestContainerType xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:CertificationCommands="com.esprow.nozomi.testunit.commands.certification" xmlns:TestUnit="com.esprow.nozomi.testunit" formatVersion="2.1">
  <test comment="This certification test checks the querying of reference data (DQ124)." loggingLevel="DEBUG" certificationUnit="true" dictionary="SGX_OMnet" implementsBridgeMode="true">
    <testCommand xsi:type="CertificationCommands:CreateMessageRelayCommand" targetSystemId="%CONFIGURATIONS.CERTIFICATION.SYSTEM%" targetHandlerId="%CONFIGURATIONS.CERTIFICATION.DESTINATION%" forwardSystemId="%CONFIGURATIONS.CERTIFICATION.BRIDGE.SYSTEM%" forwardHandlerId="%CONFIGURATIONS.CERTIFICATION.BRIDGE.DESTINATION%" filterShowOnly="true" validateMessages="true">
      <messageTypeFilters>DQ124</messageTypeFilters>
      <messageTypeFilters>DA124</messageTypeFilters>
      <messageTypeFilters>LOGIN_DEPRECATED</messageTypeFilters>
      <messageTypeFilters>LOGIN_ENCRYPTED</messageTypeFilters>
    </testCommand>
    <testCommand xsi:type="TestUnit:LogEntry" disabled="true" text="# Step 1"/>
    <testCommand xsi:type="TestUnit:ClearMessageQueue" messageSenderProducer="//@test/@testCommand.0" incoming="false" outgoing="true"/>
    <testCommand xsi:type="TestUnit:GetInteractiveFeedbackCommand">
      <instructionMultiLanguage key="en" value="Please submit a DQ124 to query all tradable instrument series in all markets."/>
    </testCommand>
    <testCommand xsi:type="TestUnit:WaitCommand" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" removeMatched="true">
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.server_type_c" value="Q" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.segment_number_n" value="1" fieldType="BigDecimal"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.download_ref_number_q" value="0" fieldType="Long"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.series[].series_t.market_c" value="0" fieldType="BigDecimal"/>
      <messageType>DQ124</messageType>
    </testCommand>
    <testCommand xsi:type="TestUnit:WaitCommand" messageId="DA124" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" outgoingMessage="true" removeMatched="true">
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.server_type_c" value="A" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
      <messageType>DA124</messageType>
    </testCommand>
    <testCommand xsi:type="TestUnit:NewVar" variableId="Segment_No" value="%MESSAGES.DA124.answer_segment_hdr_t[].answer_segment_hdr_t.segment_number_n%"/>
    <testCommand xsi:type="TestUnit:NewVar" variableId="DQ124_DL_Ref_No" value="%MESSAGES.DA124.ns_delta_header_t[].ns_delta_header_t.download_ref_number_q%"/>
    <testCommand xsi:type="TestUnit:WhileLoopCommand" logicStatement="%VARIABLES.Segment_No%!=0" maxIterationSafety="">
      <testCommand xsi:type="TestUnit:WaitCommand" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" removeMatched="true">
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.server_type_c" value="Q" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.segment_number_n" value="%VARIABLES.Segment_No%+1" fieldType="BigDecimal"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.series[].series_t.market_c" value="0" fieldType="BigDecimal"/>
        <messageType>DQ124</messageType>
      </testCommand>
      <testCommand xsi:type="TestUnit:WaitCommand" messageId="DA124" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" outgoingMessage="true" removeMatched="true">
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.server_type_c" value="A" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
        <messageType>DA124</messageType>
      </testCommand>
      <testCommand xsi:type="TestUnit:NewVar" variableId="Segment_No" value="%MESSAGES.DA124.answer_segment_hdr_t[].answer_segment_hdr_t.segment_number_n%"/>
      <testCommand xsi:type="TestUnit:NewVar" variableId="DQ124_DL_Ref_No" value="%MESSAGES.DA124.ns_delta_header_t[].ns_delta_header_t.download_ref_number_q%"/>
    </testCommand>
    <testCommand xsi:type="TestUnit:GetInteractiveFeedbackCommand" variableId="Response" requireUserInput="true">
      <instructionMultiLanguage key="en" value="Did you receive DA124 answer(s) with all tradable instrument series in all markets?&#xD;&#xA;(Enter y for yes, n for no)"/>
    </testCommand>
    <testCommand xsi:type="TestUnit:IfStatementCommand">
      <testCommand xsi:type="TestUnit:IfThenElseStatementBlock" logicStatement="eval(&quot;! equalsIgnoreCase(&quot;%VARIABLES.Response%&quot;, &quot;y&quot;) &amp;&amp; ! equalsIgnoreCase(&quot;%VARIABLES.Response%&quot;, &quot;yes&quot;)&quot;)">
        <testCommand xsi:type="TestUnit:FailCommand" text="You should have received DA124 answer(s) with all tradable instrument series in all markets."/>
      </testCommand>
    </testCommand>
    <testCommand xsi:type="TestUnit:LogEntry" disabled="true" text="# Step 19"/>
    <testCommand xsi:type="TestUnit:ClearMessageQueue" messageSenderProducer="//@test/@testCommand.0" incoming="false" outgoing="true"/>
    <testCommand xsi:type="TestUnit:GetInteractiveFeedbackCommand">
      <instructionMultiLanguage key="en" value="Please submit a DQ124 to query information on the updated instrument series.&#xD;&#xA;&#xD;&#xA;Note: only query for the delta, i.e. the changes since the previous DQ124 query you executed in the first step of the test."/>
    </testCommand>
    <testCommand xsi:type="TestUnit:WaitCommand" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" removeMatched="true">
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.server_type_c" value="Q" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.segment_number_n" value="1" fieldType="BigDecimal"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.download_ref_number_q" value="%VARIABLES.DQ124_DL_Ref_No%+1" fieldType="Long"/>
      <messageType>DQ124</messageType>
    </testCommand>
    <testCommand xsi:type="TestUnit:WaitCommand" messageId="DA124_2" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" outgoingMessage="true" removeMatched="true">
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.server_type_c" value="A" fieldType="Char"/>
      <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
      <messageType>DA124</messageType>
    </testCommand>
    <testCommand xsi:type="TestUnit:NewVar" variableId="Segment_No_2" value="%MESSAGES.DA124_2.answer_segment_hdr_t[].answer_segment_hdr_t.segment_number_n%"/>
    <testCommand xsi:type="TestUnit:LogEntry" text="Segment No 2: %VARIABLES.Segment_No_2%"/>
    <testCommand xsi:type="TestUnit:WhileLoopCommand" logicStatement="%VARIABLES.Segment_No_2%!=0" maxIterationSafety="">
      <testCommand xsi:type="TestUnit:WaitCommand" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" removeMatched="true">
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.server_type_c" value="Q" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="query_delta_t[].query_delta_t.segment_number_n" value="%VARIABLES.Segment_No_2%+1" fieldType="BigDecimal"/>
        <messageType>DQ124</messageType>
      </testCommand>
      <testCommand xsi:type="TestUnit:WaitCommand" messageId="DA124_2" messageSenderProducer="//@test/@testCommand.0" messageCount="1" timeout="-1" searchFromLastMatch="true" searchFromLastMatchCombined="true" outgoingMessage="true" removeMatched="true">
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.central_module_c" value="D" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.server_type_c" value="A" fieldType="Char"/>
        <testCommand xsi:type="TestUnit:CreateFieldValueCheckCommand" path="answer_segment_hdr_t[].answer_segment_hdr_t.transaction_type[].transaction_type_t.transaction_number_n" value="124" fieldType="BigDecimal"/>
        <messageType>DA124</messageType>
      </testCommand>
      <testCommand xsi:type="TestUnit:NewVar" variableId="Segment_No_2" value="%MESSAGES.DA124_2.answer_segment_hdr_t[].answer_segment_hdr_t.segment_number_n%"/>
    </testCommand>
    <testCommand xsi:type="TestUnit:GetInteractiveFeedbackCommand" variableId="Response" requireUserInput="true">
      <instructionMultiLanguage key="en" value="Did you receive a DA124 answer containing only the instrument series that was changed by the conformance support team?&#xD;&#xA;(Enter y for yes, n for no)"/>
    </testCommand>
    <testCommand xsi:type="TestUnit:IfStatementCommand">
      <testCommand xsi:type="TestUnit:IfThenElseStatementBlock" logicStatement="eval(&quot;! equalsIgnoreCase(&quot;%VARIABLES.Response%&quot;, &quot;y&quot;) &amp;&amp; ! equalsIgnoreCase(&quot;%VARIABLES.Response%&quot;, &quot;yes&quot;)&quot;)">
        <testCommand xsi:type="TestUnit:FailCommand" text="You should have received a DA124 answer containing only the instrument series that was changed by the conformance support team."/>
      </testCommand>
    </testCommand>
  </test>
</TestUnit:TestContainerType>
